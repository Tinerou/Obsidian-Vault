### Finite Machines
The behavior of a sequential circuit can be described using a **finite state machine (FSM)**
![[Pasted image 20251015114423.png]]


A finite state machine consists of:
- A set of states (nodes): $S =$ {$s_0, s_1, ..., s_k$}
- A starting state $s_0$
- A set of inputs: $X=$ {$x_0, x_1, ..., x_m$}
- A set of outputs: $Y=$ {$y_0, y_1, ..., y_n$}
- A transition function: $s(t+1)=T(s(t),x(t))$
- An output function(s) based on the current state and inputs:
	- $y_n=$ $F(s(t),x(t))$

#### Example
- Each state is labeled with a different binary number
	- In this example, there are 6 states so a 3-bit binary number is needed
- Each transition is labeled with an input and an output in the form (Input/Output)
	- In this example, there is a single input bit and a single output bit
- The input bit directs which state to visit next. Each unique input combination must appear on exactly one outgoing edge from each state
![[Pasted image 20251015115048.png]]

**Truth Table** 
![[Pasted image 20251015115927.png]]

Boolean formula for each next state bit:
![[Pasted image 20251015120041.png]]

---

### Vending Machine Example
#### Instructions
**What to do?** 
- Build an FSM for the controller of a soda vending machine
- Input:
	- coin trigger
	- refund button
	- drink selector
- Output:
	- drink release latch 
	- coin refund latch
**Rules and Assumptions**
- Assume infinite number of drinks
- Accepts quarters only
- All drinks are 75 cents
- Once they have 75 cents, they can select a drink
- If they want a refund, release any coins inserted
- If a 4th quarter is entered immediately refund that quarter
- No free (or discounted) drinks
- No stealing money
**Steps to Solve**
Here is the process for problems of this sort:
1) Determine the states
2) Determine the transitions from each state based on the input
3) Determine the outputs based on the input and current state
4) Create the truth table
5) Create Boolean functions for the next state and output bits

#### Application

*Step 1: Determine the states*
4 states:
- 0 coins = 0 cents
- 1 coin = 25 cents
- 2 coins = 50 cents
- 3 coins = 75 cents
*Step 2: Determine the transitions from each state based on the input*
*Step 3: Determine the outputs based on the input and current state*
These 2 steps are done using an SFM diagram
- Input: Let $C$ = coin, $D$ = drink button, $R$ = refund button
	- The next input is the next activity done by user (no ties)
- Output: Represented using 2 digits:
	- First digit: Number of drinks returned
	- Second digit: Number of drinks returned
![[Pasted image 20251015122841.png]]

*Step 4: Create truth table*
- 4 input bits: 2 for current state, 2 bits for the 3 input combinations $(I_1I_0)$
	- Let `00`: coin, `01`: drink, `10`: refund
- 5 output bits: 2 for next state, 1 for number of drinks returned($D$), 2 for number of coins returned$(R_1R_0)$

![[Pasted image 20251015123241.png]]

*Step 5: Create Boolean functions for the next state and output bits*
- Use the same procedure from previous Examples
$$R_{0} = \overline{Q_{1}}Q_{0}I_{1}\overline{I_{0}}+Q_{1}Q_{0}\overline{I_{1}}\space \overline{I_{0}}+Q_{1}Q_{0}I_{1}\overline{I_{0}}$$
