#ComputerOrganization 

### Input / Output

#### I/O Hardware Definitions
**Port:** A connection point between a machine and device.
- Port number is an I/O address
**Controller:** Something that operates a port, a bus, and/or I/O device.
- Typically acts as an interface between the bus and the device.
**Chipset:** A set of components in an integrated circuit that manages the data flow between the CPU, memory and peripherals.
- It is usually found on the motherboard.
- Chipsets are usually designed to work with a specific family of microprocessors.
![[image-40.png]]

#### CPU - I/O Interface
How does the CPU interact with I/O devices?
- *Port mapped I/O*
	- Uses I/O instructions `in` and `out` to communicate with device.
	- Requires port number of the I/O device.
- *Memory mapped I/O*
	- Use `lw` and `sw` to communicate with device.
	- I/O devices are mapped to addresses.
#### I/O Commands
There are 4 types of I/O commands:
1) *Control:* Tell a device to do something.
2) *Test:* Check the status of a device.
3) *Read:* Get data from the device.
4) *Write:* Send data to the device.
Note: Displaying single character can involve several commands

#### I/O Programming
User program calls an I/O library routine.
- Most programming languages have a standard I/O library and/or I/O built-in to the language.
The I/O library routine calls the appropriate OS system call.
- The operating system controls access to I/O devices preventing misuse.
The OS calls the appropriate routine in the device driver.
- The device driver is provided by the I/O device vendor.
- Only the vendor need  to know the internal details of interacting with the device.

### Polling
I/O can be controlled in 2 general ways:
**Polling:** Continually poll to detect data arrival.
**Interrupts:** Asynchronously alert the CPU that data is available.

#### Polling
**Polling:** CPU constantly checks the status of the I/O device.
- For input:
	- Looking for when data is ready.
- For output (and other commands):
	- Looking for a transition from busy to available.
##### Advantages and Disadvantages
*Advantages:*
- More program control of I/O.
- Efficient if wait is short.
*Disadvantages:*
- CPU is not doing anything useful by constantly asking…
- CPU is not doing anything useful by constantly asking…
- CPU is not doing anything useful by constantly asking…

### Interrupts
An **interrupt** is a change in the flow that is external to the program.
- Typically the interrupt is related to an I/O event.

- A CPU has an input line `INT` that allows I/O devices to interrupt the CPU.
- A CPU has an output line `INTA` that acknowledges interrupts.
- I/O device can interrupt processor when:
	- data is available to transfer
	- I/O request is complete

#### Interrupts: Basic Flow
1) I/O device triggers CPU interrupt request line.
2) CPU receives interrupt.
3) CPU suspends currently running program to execute code to handle the interrupt.
4) After the interrupt has been handled, the running program is resumed where it left off.
![[Unit 6 Class Slides Sec 02_Extracted.pdf]]
#### Interrupt Service Routine
An **interrupt service routine** for I/O devices does the following:
1) Save all registers on the stack.
2) Execute I/O device code.
	- This will involve code from the device driver.
3) Restore the registers.
4) Return to original process (where it left off).

#### Handling Interrupts in the CPU
- Interrupts can occur at any time without advance notice.
- Need to check for interrupts at the end of each instruction.
	- In a pipelined implementation, squash all instructions still in the pipeline.
![[image-41.png|570x232]]

#### Issues with Interrupts
Handling multiple interrupts at once.
- Interrupt vector table is prioritized.
- Interrupt priority levels: Lower levels are automatically disabled when servicing higher priority interrupts.
- I/O controllers may also resolve cases where multiple I/O devices what to interrupt the CPU.
Need to defer interrupt handling during critical processing.
- Temporarily enable and disable all interrupts.
- Maskable interrupts can be turned off and on individually.
- Some interrupts are not maskable (used for unrecoverable errors).

#### Traps
A **trap** is similar to an interrupt but is caused by an abnormal execution of an instruction.
Examples of situations that cause traps:
- Divide by zero errors
- Invalid memory access
- Illegal instruction
- Non-existent I/O device

#### Traps vs. Interrupts
When a trap occurs, flow transfers to a *trap handler* specific to the situation that caused the trap.
- trap handler = interrupt service routine
- Systems use the same interrupt mechanism to handle traps and interrupts.
Key difference between traps and interrupts:
- Traps are *synchronous*: occur at a well-defined point in the program.
- Interrupts are *asynchronous*: occur unexpectedly with respect to ongoing activity of the system.

**Intel Interrupt Vector Table**
![[image-42.png]]

